<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>miso_daily | Stock Brief</title>
  <meta name="description" content="miso_daily - ì£¼ì‹ ì†Œì‹ì„ ê¹”ë”í•˜ê²Œ ëª¨ì•„ë³´ëŠ” ë°ì¼ë¦¬ ë¸Œë¦¬í•‘" />

  <style>
    :root{
      --bg:#0b0d12;
      --panel:#121622;
      --panel2:#0f1320;
      --text:#e9edf6;
      --muted:#a9b3c7;
      --line:rgba(255,255,255,.08);

      /* ì§„í•œ ì˜¤ë Œì§€ í¬ì¸íŠ¸ */
      --accent:#ff6a00;
      --accent2:#ff8a3d;

      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --max: 1120px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(255,106,0,.18), transparent 60%),
        radial-gradient(900px 600px at 95% 10%, rgba(255,138,61,.10), transparent 55%),
        linear-gradient(180deg, #07080c 0%, var(--bg) 40%, #07080c 100%);
      letter-spacing:-0.2px;
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width:var(--max); margin:0 auto; padding:28px 18px 60px; }

    /* Topbar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      background:rgba(18,22,34,.66);
      border:1px solid var(--line);
      border-radius:var(--radius);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:10;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 230px;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, var(--accent) 0%, #ffb07a 45%, rgba(255,106,0,.18) 100%);
      display:grid; place-items:center;
      box-shadow: 0 10px 22px rgba(255,106,0,.20);
      border:1px solid rgba(255,255,255,.16);
    }
    .logo svg{ filter: drop-shadow(0 6px 10px rgba(0,0,0,.35)); }
    .brand .title{
      display:flex; flex-direction:column; line-height:1.05;
    }
    .brand .title strong{ font-size:16px; }
    .brand .title span{ font-size:12px; color:var(--muted); margin-top:4px; }

    .actions{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .chip{
      display:flex; gap:8px; align-items:center;
      padding:10px 12px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .chip b{ color:var(--text); font-weight:600; }
    .btn{
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      font-weight:600;
      transition:.15s transform, .15s background, .15s border;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.14); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(255,106,0,.95), rgba(255,138,61,.92));
      border-color: rgba(255,255,255,.12);
      color:#1a120b;
      box-shadow: 0 10px 22px rgba(255,106,0,.22);
    }
    .btn.primary:hover{ transform: translateY(-1px); filter:saturate(1.05); }

    /* Layout grid */
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ min-width:auto; }
    }

    /* Panels */
    .panel{
      background: rgba(18,22,34,.72);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel .hd{
      padding:16px 16px 12px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:flex-end; gap:10px;
    }
    .panel .hd h2{
      margin:0;
      font-size:15px;
      letter-spacing:-.2px;
    }
    .panel .hd .sub{
      color:var(--muted);
      font-size:12px;
      line-height:1.25;
    }
    .panel .bd{ padding:16px; }

    /* Market snapshot */
    .snap{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 780px){
      .snap{ grid-template-columns: repeat(2, 1fr); }
    }
    .kpi{
      padding:12px;
      border:1px solid var(--line);
      border-radius: var(--radius2);
      background: rgba(0,0,0,.18);
    }
    .kpi .name{ color:var(--muted); font-size:12px; display:flex; align-items:center; gap:8px; }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: rgba(255,255,255,.25);
    }
    .kpi .val{ margin-top:10px; font-size:18px; font-weight:750; letter-spacing:-.4px; }
    .kpi .chg{ margin-top:6px; font-family:var(--mono); font-size:12px; color:var(--muted); }
    .up{ color: #7CFFA8; }
    .down{ color: #FF7C7C; }

    /* Headlines */
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-bottom:10px;
    }
    .search{
      flex: 1 1 240px;
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(0,0,0,.18);
    }
    .search input{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-size:13px;
    }
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:12px;
      cursor:pointer;
      transition:.12s;
      user-select:none;
    }
    .pill.active{
      background: rgba(255,106,0,.16);
      border-color: rgba(255,106,0,.38);
      color: var(--text);
    }

    .cards{
      display:flex; flex-direction:column; gap:10px;
    }
    .card{
      padding:14px 14px;
      border:1px solid var(--line);
      border-radius: var(--radius2);
      background: rgba(0,0,0,.18);
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      transition: .15s transform, .15s border, .15s background;
    }
    .card:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
    }
    .card h3{
      margin:0;
      font-size:14px;
      letter-spacing:-.2px;
      line-height:1.35;
    }
    .card p{
      margin:8px 0 0;
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
    }
    .meta{
      display:flex; flex-direction:column; gap:8px; align-items:flex-end;
      min-width: 120px;
    }
    .badge{
      font-size:11px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,106,0,.35);
      background: rgba(255,106,0,.12);
      color: var(--text);
      white-space:nowrap;
    }
    .time{
      font-size:11px;
      color: var(--muted);
      font-family: var(--mono);
      white-space:nowrap;
    }
    .source{
      font-size:11px;
      color: rgba(255,255,255,.72);
      opacity:.9;
      white-space:nowrap;
    }

    /* Right side tools */
    .stack{ display:flex; flex-direction:column; gap:16px; }

    textarea{
      width:100%;
      min-height: 170px;
      resize: vertical;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding:12px;
      font-family: var(--mono);
      font-size:12px;
      line-height:1.45;
      outline:none;
    }
    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:10px;
    }
    .small{
      font-size:12px;
      color:var(--muted);
    }
    .hr{
      height:1px; background:var(--line); margin:14px 0;
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(18,22,34,.88);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow);
      color: var(--text);
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition:.18s opacity, .18s transform;
      z-index: 50;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }

    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
      opacity:.85;
    }
    .accent{
      color: var(--accent2);
      font-weight:700;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M5 15c3-7 6-8 9-8 4 0 6 3 6 6 0 4-3 6-7 6-3 0-6-2-8-4Z" stroke="rgba(20,12,6,.85)" stroke-width="2" stroke-linecap="round"/>
            <path d="M7 10h4" stroke="rgba(20,12,6,.85)" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="title">
          <strong>miso_daily</strong>
          <span id="todayLabel">Daily Stock Brief</span>
        </div>
      </div>

      <div class="actions">
        <div class="chip" title="ë¡œì»¬ ë°ì´í„° ê¸°ì¤€">
          <span>ì—…ë°ì´íŠ¸</span>
          <b id="updatedAt">â€”</b>
        </div>
        <button class="btn" id="btnCopyDigest" title="ì˜¤ëŠ˜ ë¸Œë¦¬í•‘ ë¬¸ì¥ ë³µì‚¬">
          ğŸ“‹ ë¸Œë¦¬í•‘ ë³µì‚¬
        </button>
        <button class="btn primary" id="btnReset" title="ìƒ˜í”Œ ë°ì´í„°ë¡œ ì´ˆê¸°í™”">
          âœ¨ ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°
        </button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <section class="panel">
        <div class="hd">
          <div>
            <h2>ì‹œì¥ ìŠ¤ëƒ…ìƒ·</h2>
            <div class="sub">ì§€í‘œëŠ” ìš°ì¸¡ ì…ë ¥(JSON)ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆì–´ìš”.</div>
          </div>
          <div class="sub"><span class="accent">ì§„í•œ ì˜¤ë Œì§€</span> í¬ì¸íŠ¸ UI</div>
        </div>

        <div class="bd">
          <div class="snap" id="snapshot"></div>

          <div class="hr"></div>

          <div class="hd" style="padding:0 0 10px;border:0;">
            <div>
              <h2>ì˜¤ëŠ˜ì˜ í—¤ë“œë¼ì¸</h2>
              <div class="sub">ê²€ìƒ‰/í•„í„°ë¡œ ë¹ ë¥´ê²Œ ì •ë¦¬</div>
            </div>
          </div>

          <div class="toolbar">
            <div class="search" role="search">
              ğŸ” <input id="q" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ (ì˜ˆ: ì‹¤ì , CPI, AI, ë°˜ë„ì²´)" autocomplete="off" />
            </div>
            <div class="pill active" data-filter="all">ì „ì²´</div>
            <div class="pill" data-filter="macro">ê±°ì‹œê²½ì œ</div>
            <div class="pill" data-filter="earnings">ì‹¤ì </div>
            <div class="pill" data-filter="tech">í…Œí¬</div>
            <div class="pill" data-filter="energy">ì—ë„ˆì§€</div>
          </div>

          <div class="cards" id="cards"></div>
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="stack">
        <section class="panel">
          <div class="hd">
            <div>
              <h2>ì½˜í…ì¸  ì…ë ¥</h2>
              <div class="sub">ë‰´ìŠ¤/ì§€í‘œë¥¼ JSONìœ¼ë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ ìë™ ë°˜ì˜</div>
            </div>
          </div>
          <div class="bd">
            <textarea id="jsonInput" spellcheck="false"></textarea>
            <div class="row">
              <button class="btn primary" id="btnApply">ì ìš©</button>
              <button class="btn" id="btnFormat">ì •ë¦¬(í¬ë§·)</button>
              <button class="btn" id="btnCopyJson">JSON ë³µì‚¬</button>
            </div>
            <div class="hint">
              <div class="small">í˜•ì‹</div>
              <div class="small">- snapshot: [{ name, value, change, changePct }]</div>
              <div class="small">- headlines: [{ title, summary, tag, source, timeISO, url? }]</div>
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="hd">
            <div>
              <h2>ì¹´ì¹´ì˜¤í†¡ìš© ì˜¤ëŠ˜ ë¸Œë¦¬í•‘</h2>
              <div class="sub">1ì¤„ 20~35ì ëŠë‚Œìœ¼ë¡œ ìë™ ìƒì„±</div>
            </div>
          </div>
          <div class="bd">
            <div class="small" style="margin-bottom:10px;color:var(--muted);">
              â€» íˆ¬ì ì¡°ì–¸/ê³¼ì¥ ì—†ì´, íë¦„ ì¤‘ì‹¬ìœ¼ë¡œ ì •ë¦¬
            </div>
            <textarea id="digest" readonly></textarea>
            <div class="row">
              <button class="btn" id="btnCopyDigest2">ğŸ“© ë³µì‚¬</button>
              <button class="btn" id="btnShorten">âœ‚ï¸ ë” ì§§ê²Œ</button>
            </div>
          </div>
        </section>
      </aside>
    </div>

    <footer>
      Â© <span id="year"></span> <span class="accent">miso_daily</span> â€” ë¡œì»¬ í…œí”Œë¦¿ (API ì—°ê²° ì—†ì´ë„ ë™ì‘)
    </footer>
  </div>

  <div class="toast" id="toast">ë³µì‚¬ ì™„ë£Œ</div>

  <script>
    // ---------- Utils ----------
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    function toast(msg="ì™„ë£Œ"){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 1200);
    }

    function fmtNum(n){
      if (n === null || n === undefined || n === "") return "â€”";
      const num = Number(n);
      if (Number.isNaN(num)) return String(n);
      return num.toLocaleString("en-US");
    }

    function fmtSigned(n){
      const num = Number(n);
      if (Number.isNaN(num)) return String(n ?? "â€”");
      const sign = num > 0 ? "+" : "";
      return sign + num.toLocaleString("en-US");
    }

    function fmtPct(n){
      const num = Number(n);
      if (Number.isNaN(num)) return String(n ?? "â€”");
      const sign = num > 0 ? "+" : "";
      return sign + num.toFixed(2) + "%";
    }

    function relTime(iso){
      try{
        const d = new Date(iso);
        const now = new Date();
        const diff = Math.floor((now - d) / 60000); // minutes
        if (diff < 1) return "ë°©ê¸ˆ";
        if (diff < 60) return diff + "ë¶„ ì „";
        const h = Math.floor(diff/60);
        if (h < 24) return h + "ì‹œê°„ ì „";
        const day = Math.floor(h/24);
        return day + "ì¼ ì „";
      }catch(e){
        return "â€”";
      }
    }

    function todayKSTLabel(){
      // ë¸Œë¼ìš°ì € ë¡œì»¬ ê¸°ì¤€(ëŒ€ë¶€ë¶„ KST). í•„ìš”ì‹œ Intlë¡œ KST ê³ ì •ë„ ê°€ëŠ¥.
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const da = String(d.getDate()).padStart(2,"0");
      return `${y}.${m}.${da}`;
    }

    // ---------- Sample Data ----------
    const sample = {
      updatedAtISO: new Date().toISOString(),
      snapshot: [
        { name:"S&P 500", value: 5050.12, change: +32.18, changePct: +0.64 },
        { name:"NASDAQ", value: 16020.45, change: -41.20, changePct: -0.26 },
        { name:"DOW", value: 38710.03, change: +105.50, changePct: +0.27 },
        { name:"VIX", value: 14.82, change: +0.33, changePct: +2.28 },
      ],
      headlines: [
        {
          title:"ì—°ì¤€ ë°œì–¸ì— ê¸ˆë¦¬ ê¸°ëŒ€ í”ë“¤â€¦ì±„ê¶Œ ë³€ë™ì„± í™•ëŒ€",
          summary:"ì¸í•˜ ì‹œì ì— ëŒ€í•œ ì‹œì¥ ê¸°ëŒ€ê°€ ì—‡ê°ˆë¦¬ë©°, ê¸ˆë¦¬ ë¯¼ê°ì£¼ê°€ ì¶œë ì˜€ì–´ìš”.",
          tag:"macro",
          source:"Macro Desk",
          timeISO: new Date(Date.now()-1000*60*50).toISOString(),
          url:""
        },
        {
          title:"ë¹…í…Œí¬ ì‹¤ì , â€˜ë§¤ì¶œì€ ê²¬ì¡°Â·ê°€ì´ë˜ìŠ¤ëŠ” ë³´ìˆ˜â€™ êµ¬ë„",
          summary:"í´ë¼ìš°ë“œ/ê´‘ê³ ëŠ” ìœ ì§€, ë¹„ìš© ê´€ë¦¬ê°€ ê´€ê±´. ì£¼ê°€ëŠ” ê°€ì´ë˜ìŠ¤ì— ë°˜ì‘.",
          tag:"earnings",
          source:"Earnings Wire",
          timeISO: new Date(Date.now()-1000*60*130).toISOString(),
          url:""
        },
        {
          title:"AI ì¸í”„ë¼ ìˆ˜ìš” ì§€ì†â€¦ë°˜ë„ì²´ ê³µê¸‰ë§ ì´ìŠˆ ì¬ë¶€ê°",
          summary:"ì„œë²„/ì „ë ¥/íŒ¨í‚¤ì§• ë³‘ëª©ì´ ë‹¤ì‹œ ë³€ìˆ˜ë¡œ. ê´€ë ¨ ì¢…ëª©ì€ í…Œë§ˆ ë¯¼ê°.",
          tag:"tech",
          source:"Tech Brief",
          timeISO: new Date(Date.now()-1000*60*220).toISOString(),
          url:""
        },
        {
          title:"ìœ ê°€ ë‹¨ê¸° ë°˜ë“±â€¦ì¬ê³ /ì§€ì •í•™ ì´ìŠˆì— ë¯¼ê°",
          summary:"ì¬ê³  ì§€í‘œì™€ ì¤‘ë™ í—¤ë“œë¼ì¸ì´ ë‹¨ê¸° ë°©í–¥ì„± ì¢Œìš°. ì—ë„ˆì§€ ì„¹í„°ëŠ” ë¶„ì‚°.",
          tag:"energy",
          source:"Energy Note",
          timeISO: new Date(Date.now()-1000*60*400).toISOString(),
          url:""
        }
      ]
    };

    // ---------- State ----------
    let state = structuredClone(sample);
    let activeFilter = "all";
    let query = "";

    // ---------- Renderers ----------
    function renderHeader(){
      $("#todayLabel").textContent = `Daily Stock Brief Â· ${todayKSTLabel()}`;
      $("#updatedAt").textContent = new Date(state.updatedAtISO).toLocaleString();
      $("#year").textContent = new Date().getFullYear();
    }

    function renderSnapshot(){
      const el = $("#snapshot");
      el.innerHTML = "";
      state.snapshot.forEach(item => {
        const updown = Number(item.changePct) >= 0 ? "up" : "down";
        const dotColor = Number(item.changePct) >= 0 ? "rgba(124,255,168,.9)" : "rgba(255,124,124,.9)";
        const card = document.createElement("div");
        card.className = "kpi";
        card.innerHTML = `
          <div class="name"><span class="dot" style="background:${dotColor}"></span>${item.name}</div>
          <div class="val">${fmtNum(item.value)}</div>
          <div class="chg ${updown}">${fmtSigned(item.change)} (${fmtPct(item.changePct)})</div>
        `;
        el.appendChild(card);
      });
    }

    function passesFilter(h){
      if (activeFilter === "all") return true;
      return (h.tag || "").toLowerCase() === activeFilter;
    }

    function passesQuery(h){
      if (!query) return true;
      const t = (h.title + " " + (h.summary||"") + " " + (h.source||"")).toLowerCase();
      return t.includes(query.toLowerCase());
    }

    function renderCards(){
      const el = $("#cards");
      el.innerHTML = "";
      const filtered = state.headlines
        .filter(passesFilter)
        .filter(passesQuery)
        .sort((a,b)=> new Date(b.timeISO) - new Date(a.timeISO));

      if (filtered.length === 0){
        el.innerHTML = `<div class="small" style="color:var(--muted);padding:8px 2px;">ê²°ê³¼ê°€ ì—†ì–´ìš”. ê²€ìƒ‰ì–´ë‚˜ í•„í„°ë¥¼ ë°”ê¿”ë³´ì„¸ìš”.</div>`;
        return;
      }

      filtered.forEach(h => {
        const tagLabel = ({
          macro:"ê±°ì‹œê²½ì œ",
          earnings:"ì‹¤ì ",
          tech:"í…Œí¬",
          energy:"ì—ë„ˆì§€"
        }[h.tag] || (h.tag || "ê¸°íƒ€"));

        const card = document.createElement("a");
        card.className = "card";
        card.href = h.url && h.url.trim() ? h.url.trim() : "javascript:void(0)";
        card.target = h.url && h.url.trim() ? "_blank" : "_self";
        card.rel = "noopener";

        card.innerHTML = `
          <div>
            <h3>${escapeHtml(h.title)}</h3>
            <p>${escapeHtml(h.summary || "")}</p>
          </div>
          <div class="meta">
            <div class="badge">${tagLabel}</div>
            <div class="time">${relTime(h.timeISO)}</div>
            <div class="source">${escapeHtml(h.source || "")}</div>
          </div>
        `;

        el.appendChild(card);
      });
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ---------- Digest ----------
    function buildDigest(compact=false){
      // 1) ì „ì²´ íë¦„ 3ì¤„ + ìš©ì–´ 1ê°œ + ê²°ë¡ 
      const top = [...state.headlines]
        .sort((a,b)=> new Date(b.timeISO) - new Date(a.timeISO))
        .slice(0,3);

      const flow = [
        "ì‹œì¥ì€ ê¸ˆë¦¬ ê¸°ëŒ€ì— ë¯¼ê°í–ˆì–´ìš”.",
        "ì‹¤ì ì€ â€˜ê²¬ì¡°Â·ë³´ìˆ˜ ê°€ì´ë˜ìŠ¤â€™ êµ¬ë„.",
        "í…Œë§ˆëŠ” AI ì¸í”„ë¼/ê³µê¸‰ë§ì´ ë³€ìˆ˜."
      ];

      // ì•„ì£¼ ë‹¨ìˆœí•œ ìš©ì–´(í•„ìš”ì‹œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ)
      const term = {
        word: "ê°€ì´ë˜ìŠ¤(Guideance)",
        meaning: "ê¸°ì—…ì´ ì œì‹œí•˜ëŠ” í–¥í›„ ì‹¤ì  ì „ë§ì¹˜",
        why: "ìˆ˜ì¹˜ê°€ ê¸°ëŒ€ë¥¼ í”ë“¤ë©´ ì£¼ê°€ê°€ ì¦‰ì‹œ ë°˜ì‘"
      };

      const head = `ğŸ“Œ  ì˜¤ëŠ˜ì˜  miso_daily í—¤ë“œë¼ì¸ (${todayKSTLabel()}) ğŸ“…`;
      const lines = [];
      lines.push(head);
      lines.push("");
      lines.push("ğŸ§  ì‰½ê²Œ ìš”ì•½í•˜ê¸°");
      flow.forEach(s => lines.push(`- ${s}`));
      lines.push("");
      lines.push("ğŸ“š ê²½ì œ ìš©ì–´ 1ê°œ");
      lines.push(`- ìš©ì–´: ${term.word}`);
      lines.push(`- ëœ»: ${term.meaning}`);
      lines.push(`- ì™œ ì¤‘ìš”?: ${term.why}`);
      lines.push("");
      lines.push("âœ… ê²°ë¡ ");
      lines.push("- ì˜¤ëŠ˜ì€ â€˜ê¸°ëŒ€ vs í˜„ì‹¤â€™ì˜ ì‹¸ì›€ì´ì—ìš”. ìˆ«ìë³´ë‹¤ í†¤(ê°€ì´ë˜ìŠ¤)ì„ ë³´ì„¸ìš”.");

      if (!compact){
        lines.push("");
        lines.push("ğŸ— ì£¼ìš” ê¸°ì‚¬ 3ê°œ");
        top.forEach((h,i)=> {
          const one = `${i+1}) ${h.title}`;
          lines.push(`- ${trimTo(one, 38)}`);
        });
      } else {
        // ë” ì§§ê²Œ: í•µì‹¬ë§Œ
        const mini = [
          "ê¸ˆë¦¬ ê¸°ëŒ€ í”ë“¤ â†’ ë³€ë™ì„± í™•ëŒ€",
          "ì‹¤ì ì€ ê°€ì´ë˜ìŠ¤ê°€ ìŠ¹ë¶€ì²˜",
          "AI/ë°˜ë„ì²´ëŠ” ë³‘ëª©ì´ ë³€ìˆ˜"
        ];
        return mini.map(s => `- ${s}`).join("\n");
      }

      return lines.join("\n");
    }

    function trimTo(s, max){
      s = String(s);
      if (s.length <= max) return s;
      return s.slice(0, max-1) + "â€¦";
    }

    // ---------- JSON Handling ----------
    function loadToTextarea(){
      $("#jsonInput").value = JSON.stringify(state, null, 2);
    }

    function applyFromTextarea(){
      try{
        const obj = JSON.parse($("#jsonInput").value);
        // minimal validation
        if (!obj.snapshot || !Array.isArray(obj.snapshot)) throw new Error("snapshot ë°°ì—´ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        if (!obj.headlines || !Array.isArray(obj.headlines)) throw new Error("headlines ë°°ì—´ì´ í•„ìš”í•©ë‹ˆë‹¤.");

        obj.updatedAtISO = obj.updatedAtISO || new Date().toISOString();
        state = obj;

        renderAll();
        toast("ì ìš© ì™„ë£Œ");
      }catch(e){
        toast("JSON ì˜¤ë¥˜: " + (e.message || "í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”"));
      }
    }

    function renderAll(){
      renderHeader();
      renderSnapshot();
      renderCards();
      $("#digest").value = buildDigest(false);
    }

    // ---------- Events ----------
    function bind(){
      // filter pills
      $$(".pill").forEach(p => {
        p.addEventListener("click", () => {
          $$(".pill").forEach(x => x.classList.remove("active"));
          p.classList.add("active");
          activeFilter = p.dataset.filter;
          renderCards();
        });
      });

      $("#q").addEventListener("input", (e)=> {
        query = e.target.value.trim();
        renderCards();
      });

      $("#btnApply").addEventListener("click", applyFromTextarea);
      $("#btnFormat").addEventListener("click", ()=>{
        try{
          const obj = JSON.parse($("#jsonInput").value);
          $("#jsonInput").value = JSON.stringify(obj, null, 2);
          toast("ì •ë¦¬ ì™„ë£Œ");
        }catch{
          toast("JSON ì˜¤ë¥˜");
        }
      });

      $("#btnCopyJson").addEventListener("click", async ()=>{
        await navigator.clipboard.writeText($("#jsonInput").value);
        toast("JSON ë³µì‚¬ ì™„ë£Œ");
      });

      $("#btnCopyDigest").addEventListener("click", async ()=>{
        await navigator.clipboard.writeText($("#digest").value);
        toast("ë¸Œë¦¬í•‘ ë³µì‚¬ ì™„ë£Œ");
      });
      $("#btnCopyDigest2").addEventListener("click", async ()=>{
        await navigator.clipboard.writeText($("#digest").value);
        toast("ë¸Œë¦¬í•‘ ë³µì‚¬ ì™„ë£Œ");
      });

      $("#btnShorten").addEventListener("click", ()=>{
        $("#digest").value = buildDigest(true);
        toast("ì§§ê²Œ ë§Œë“¤ì—ˆì–´ìš”");
      });

      $("#btnReset").addEventListener("click", ()=>{
        state = structuredClone(sample);
        loadToTextarea();
        renderAll();
        toast("ìƒ˜í”Œ ë¡œë“œ ì™„ë£Œ");
      });
    }

    // ---------- Init ----------
    (function init(){
      state.updatedAtISO = new Date().toISOString();
      loadToTextarea();
      bind();
      renderAll();
    })();
  </script>
</body>
</html>
